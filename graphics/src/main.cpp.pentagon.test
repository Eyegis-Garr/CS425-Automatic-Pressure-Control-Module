#include <Arduino.h>
#include <avr8-stub.h>
#include <string.h>

#include "ili9341.h"
#include "graphics.h"
#include "element.h"

int build_polygon(int n_vertices, vertex_t *vbuf, int *ibuf, int radius);
void setup_scene();

element_t pentagon;

void setup() {
	init_display();
	r_init();

	setup_scene();

	e_update(&pentagon);
	e_draw(&pentagon);
}

void loop() {
	
}

int build_polygon(int n_vertices, vertex_t *vbuf, int *ibuf, int radius) {
	if (!vbuf || !ibuf || n_vertices <= 0) {
		return -1;
	}

	float r = DEG_TO_RAD * (360 / n_vertices);
	mat3 o = IDENT_MAT3;
	vec3 v = { 1, 0, 1 };

	vec2 t = (vec2) { radius, 0 };
	translate_mat3(&t, &o);
	rotate_mat3(r, &o);

	for (int i = 0; i < n_vertices; i += 1) {
		// compute color
		uint16_t c = 0x0000;
		vbuf[i].color = c;
		transform_vec3(&o, &v, &vbuf[i].pos);
		ibuf[i] = i;
		rotate_mat3(r, &o);
	}

	return 0;
}

void setup_scene() {
	pentagon = new_element(ORIGIN, 4, NULL, DRAW_LINE_LOOP, 0);
	build_polygon(4, pentagon.vbuf, pentagon.ibuf, 32);
}