#include <Arduino.h>
#include <avr8-stub.h>
#include <string.h>

#include "ili9341.h"
#include "graphics.h"
#include "element.h"
#include "font.h"

void blit_char(uint8_t i, int x, int y);
void blit_str(char *str, int len, int x, int y);

void setup() {
	init_display();

	char s[8]; sprintf(s, "HELLO");
	blit_str(s, 5, 50, 50);
	sprintf(s, "WORLD");
	blit_str(s, 5, 30, 150);
}

void loop() {
	
}

void blit_char(uint8_t c, int x, int y) {
	const uint8_t *fc = alpha[c];
	uint8_t col = pgm_read_byte(fc++);
	uint8_t row = pgm_read_byte(fc++);
	begin_write();
		for (int i = 0; i < row; i += 1) {
			for (int k = 0; k < col; k += 1) {
				uint8_t byte = pgm_read_byte(fc++);
				if (byte) set_pixel(x + k, y + i, 0);
			}
		}
	end_write();
}

void blit_str(char *str, int len, int x, int y) {
	int xpos = x, ypos = y;
	for (int i = 0; i < len; i += 1) {
		blit_char((uint8_t)(str[i] - 'A'), xpos, ypos);
		xpos += 25; ypos += 25;
	}
}